@{
    ViewData["Title"] = "Giỏ hàng";
    Layout = "~/Views/Shared/_CartLayout.cshtml";
}
@model List<BTL_LTWeb.Models.TGioHang>

@if (Model.Count < 1)
{
    <h2>Không có sản phẩm nào trong giỏ hàng</h2>
}
else
{

    <div class="row mb-5">
        <form class="col-md-12" method="post">
            <div class="site-blocks-table">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="product-thumbnail">Ảnh</th>
                            <th class="product-name">Tên sản phẩm</th>
                            <th class="product-price">Giá</th>
                            <th class="product-quantity">Số lượng</th>
                            <th class="product-total">Tổng</th>
                            <th class="product-remove">Xóa</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            if (item?.ChiTietSanPham != null && item.ChiTietSanPham.DanhMucSp != null)
                            {
                                @await Html.PartialAsync("_CartPartial", item)
                                ;
                            }
                            else
                            {
                                // Nếu không có thông tin sản phẩm, hiển thị dòng thông báo
                                <tr>
                                    <td colspan="5" class="text-center">Sản phẩm không có thông tin.</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </form>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="row mb-5">
                <div class="col-md-6 mb-3 mb-md-0">
                    <button class="btn btn-primary btn-sm btn-block">Cập nhật giỏ hàng</button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-outline-primary btn-sm btn-block">Tiếp tục mua hàng</button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <label class="text-black h4" for="coupon">Mã giảm giá</label>
                    <p>Nhập mã giảm giá</p>
                </div>
                <div class="col-md-8 mb-3 mb-md-0">
                    <input type="text" class="form-control py-3" id="coupon" placeholder="Mã giảm giá">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary btn-sm">Áp dụng mã giảm giá</button>
                </div>
            </div>
        </div>
        <div class="col-md-6 pl-5">
            <div class="row justify-content-end">
                <div class="col-md-7">
                    <div class="row">
                        <div class="col-md-12 text-right border-bottom mb-5">
                            <h3 class="text-black h4 text-uppercase">Tổng tiền</h3>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <span class="text-black">Giảm</span>
                        </div>
                        <div class="col-md-6 text-right">
                            <strong class="text-black">0</strong>
                        </div>
                    </div>
                    <div class="row mb-5">
                        <div class="col-md-6">
                            <span class="text-black">Phải thanh toán</span>
                        </div>
                        <div class="col-md-6 text-right">
                            <strong class="text-black total-amount">0.00</strong>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <button class="btn btn-primary btn-lg py-3 btn-block" onclick="window.location='checkout.html'">Thanh toán</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section Scripts {
    <script>
        $(document).ready(function () {
            // Gán sự kiện cho các button
            $(document).on('click', '.js-btn-plus', function () {
                let input = $(this).closest('tr').find('input');
                let value = parseInt(input.val()) + 1;
                input.val(value);
                // Cập nhật tổng tiền hoặc gửi dữ liệu đến server
                updateTotal(input.closest('tr'));
            });

            $(document).on('click', '.js-btn-minus', function () {
                let input = $(this).closest('tr').find('input');
                let value = parseInt(input.val()) - 1;
                if (value >= 0) {
                    input.val(value);
                    // Cập nhật tổng tiền hoặc gửi dữ liệu đến server
                    updateTotal(input.closest('tr'));
                }
            });
            let grandTotal = 0;
            $('.site-blocks-table tbody tr').each(function () {
                let rowTotal = parseFloat($(this).find('td:eq(4)').text()) || 0;
                grandTotal += rowTotal;
            });

            // Cập nhật hiển thị tổng phải thanh toán
            $('.total-amount').text(grandTotal.toFixed(2)); // Định dạng 2 chữ số thập phân

        });


        function updateTotal(row) {
            // Tính tổng tiền cho hàng này
            let price = parseFloat(row.find('td:eq(2)').text());
            let quantity = parseInt(row.find('input').val());
            let total = price * quantity;
            row.find('td:eq(4)').text(total);

            
        }
    </script>
}